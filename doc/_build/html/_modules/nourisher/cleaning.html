<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>nourisher.cleaning &mdash; nourisher  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="nourisher  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">nourisher  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for nourisher.cleaning</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on Dec 22, 2014</span>

<span class="sd">@author: dan</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">nourisher</span> <span class="kn">import</span> <span class="n">utiliser</span>
<div class="viewcode-block" id="wrangle_numbers"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.wrangle_numbers">[docs]</a><span class="k">def</span> <span class="nf">wrangle_numbers</span><span class="p">(</span> <span class="n">vst</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Converts string to numbers, if possible. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vst: string </span>
<span class="sd">        in several forms - these that are collected by scrapers</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        wrangled number</span>
<span class="sd">    </span>
<span class="sd">    Note</span>
<span class="sd">    -----</span>
<span class="sd">    It will probably give some errors, but they can be handled </span>
<span class="sd">    by IFs (better for debugging)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">locale</span> <span class="kn">import</span> <span class="n">setlocale</span><span class="p">,</span> <span class="n">LC_ALL</span><span class="p">,</span> <span class="n">atof</span>
    <span class="n">setlocale</span><span class="p">(</span> <span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&quot;en_US.UTF8&quot;</span> <span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">vst</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span> <span class="n">vst</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">vysl</span> <span class="o">=</span> <span class="n">vst</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span> <span class="n">vst</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="n">vysl</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">vst</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">vst</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span> <span class="n">vst</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">numb</span> <span class="o">=</span> <span class="n">vst</span>

        <span class="c"># percents to [0,1]</span>
        <span class="k">if</span> <span class="n">numb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;%&quot;</span><span class="p">:</span>
            <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">numb</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>

        <span class="c"># websiteout and urlm worth</span>
        <span class="k">elif</span> <span class="p">(</span> <span class="s">&quot;Million&quot;</span> <span class="ow">in</span> <span class="n">numb</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span> <span class="s">&quot;Billion&quot;</span> <span class="ow">in</span> <span class="n">numb</span> <span class="p">):</span>

            <span class="c"># urlm</span>
            <span class="k">if</span> <span class="n">numb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">r&quot;$&quot;</span><span class="p">:</span>
                <span class="n">numb</span> <span class="o">=</span> <span class="n">numb</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="s">&#39;Million&#39;</span> <span class="ow">in</span> <span class="n">numb</span><span class="p">:</span>
                <span class="n">spl</span> <span class="o">=</span> <span class="n">numb</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&quot; &quot;</span> <span class="p">)</span>
                <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">spl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">1000000</span>
            <span class="k">if</span> <span class="s">&quot;Billion&quot;</span> <span class="ow">in</span> <span class="n">numb</span><span class="p">:</span>
                <span class="n">spl</span> <span class="o">=</span> <span class="n">numb</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&quot; &quot;</span> <span class="p">)</span>
                <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">spl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">1000000000</span>
        <span class="c"># some webs return slash when no information are provided</span>

        <span class="k">elif</span> <span class="n">numb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">r&quot;$&quot;</span><span class="p">:</span>
            <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">numb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span>

        <span class="k">elif</span> <span class="n">numb</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span> <span class="ow">or</span> <span class="n">numb</span> <span class="o">==</span> <span class="s">&quot;--&quot;</span><span class="p">:</span>
            <span class="n">vysl</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># urlm sometimes throws e.g. &quot;&lt; 300&quot;</span>
        <span class="k">elif</span> <span class="n">numb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span><span class="p">:</span>
            <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">numb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vysl</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">numb</span> <span class="p">)</span>

    <span class="k">elif</span> <span class="n">vst</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">vst</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">vysl</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">utiliser</span><span class="o">.</span><span class="n">informer</span><span class="p">(</span> <span class="s">&quot;Wrangling from: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">vst</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot; to:</span><span class="se">\t</span><span class="s"> &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">vysl</span> <span class="p">),</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">vysl</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="time_to_dec"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.time_to_dec">[docs]</a><span class="k">def</span> <span class="nf">time_to_dec</span><span class="p">(</span> <span class="n">time</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert time interval from MM:SS to MM.S</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    string of time</span>
<span class="sd">        time in MM:SS format</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        time in minutes in decimal format</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">locale</span> <span class="kn">import</span> <span class="n">setlocale</span><span class="p">,</span> <span class="n">LC_ALL</span><span class="p">,</span> <span class="n">atof</span>
    <span class="n">setlocale</span><span class="p">(</span> <span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&quot;en_US.UTF8&quot;</span> <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span>

        <span class="c"># no information provided</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span> <span class="bp">None</span> <span class="p">)</span>

        <span class="n">pl</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&quot;:&quot;</span> <span class="p">)</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span> <span class="n">pl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">secs</span> <span class="o">=</span> <span class="p">(</span> <span class="n">atof</span><span class="p">(</span> <span class="n">pl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">60</span> <span class="p">)</span>
        <span class="n">ttime</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">+</span> <span class="n">secs</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">ttime</span> <span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span> <span class="s">&quot;Nelze: &quot;</span><span class="p">,</span> <span class="n">time</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="bp">None</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="numbs_from_list"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.numbs_from_list">[docs]</a><span class="k">def</span> <span class="nf">numbs_from_list</span><span class="p">(</span> <span class="n">diction</span><span class="p">,</span> <span class="n">keys</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Tries to wrangle every string from list to numbers&#39;&#39;&#39;</span>

    <span class="n">utiliser</span><span class="o">.</span><span class="n">informer</span><span class="p">(</span> <span class="s">&quot;Finding {0} in {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="n">diction</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span> <span class="n">keys</span> <span class="p">),</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="n">new</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">new</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrangle_numbers</span><span class="p">(</span> <span class="n">diction</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">new</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="check_if_presents_list"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.check_if_presents_list">[docs]</a><span class="k">def</span> <span class="nf">check_if_presents_list</span><span class="p">(</span> <span class="n">diction</span><span class="p">,</span> <span class="n">keys</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns True if element from key is present and nonempty in diction</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    diction : dict</span>
<span class="sd">        dictionary which should be checked</span>
<span class="sd">    keys : list of strings</span>
<span class="sd">        strings that should be as keys in diction</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        in form {key:bool, ...}</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">new</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">diction</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">new</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">new</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="wrangle_entries"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.wrangle_entries">[docs]</a><span class="k">def</span> <span class="nf">wrangle_entries</span><span class="p">(</span> <span class="n">entries</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Wrangle informations from entries, basically make numbers from them</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    entries : dict </span>
<span class="sd">        of information about entries which are collected by feedInfo collector</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        wrangled informations about entries for the feed</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">newE</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># little hack</span>
    <span class="n">entries</span><span class="p">[</span><span class="s">&quot;summariesLength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[</span><span class="s">&quot;summaries&quot;</span><span class="p">]]</span>
    <span class="n">entries</span><span class="p">[</span><span class="s">&quot;titlesLength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[</span><span class="s">&quot;titles&quot;</span><span class="p">]]</span>

    <span class="n">numericLists</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;summariesLength&#39;</span><span class="p">,</span>
                    <span class="s">&#39;titlesLength&#39;</span><span class="p">,</span>
                    <span class="s">&#39;urlCountDash&#39;</span><span class="p">,</span>
                     <span class="s">&#39;htmlCodeLengthwhite&#39;</span><span class="p">,</span>
                     <span class="s">&#39;textHtmlArticleRatioWords&#39;</span><span class="p">,</span>
                     <span class="s">&#39;urlCountHash&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsEntries_img&#39;</span><span class="p">,</span>
                     <span class="s">&#39;textHtmlArticleRatioChars&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsWhole_div&#39;</span><span class="p">,</span>
                     <span class="s">&#39;matchUrlTitle&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsWhole_meta&#39;</span><span class="p">,</span>
                     <span class="s">&#39;urlAllWeirds&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsWhole_img&#39;</span><span class="p">,</span>
                     <span class="s">&#39;textCodeHtmlRatioWT&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nOfAllTagsHtml&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsEntries_div&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsWhole_iframe&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsWhole_script&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsWhole_p&#39;</span><span class="p">,</span>
                     <span class="s">&#39;uppercaseTextRatio&#39;</span><span class="p">,</span>
                     <span class="s">&#39;nTagCountsEntries_p&#39;</span><span class="p">,</span>
                     <span class="s">&#39;htmlCodeLengthChars&#39;</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">statistics</span> <span class="kn">import</span> <span class="n">stdev</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">StatisticsError</span>
    <span class="c"># take only those which are contained in entries keys</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="n">att</span> <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">numericLists</span> <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">keys</span><span class="p">()]:</span>
        <span class="c"># cleaning from None values</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">standardDev</span> <span class="o">=</span> <span class="n">stdev</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
                <span class="n">meanOfAll</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span> <span class="n">StatisticsError</span> <span class="p">):</span>
                <span class="n">standardDev</span><span class="p">,</span> <span class="n">meanOfAll</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
                <span class="n">utiliser</span><span class="o">.</span><span class="n">informer</span><span class="p">(</span> <span class="s">&quot;array is: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">entries</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">standardDev</span><span class="p">,</span> <span class="n">meanOfAll</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
            <span class="n">utiliser</span><span class="o">.</span><span class="n">informer</span><span class="p">(</span> <span class="s">r&quot;array is empty or full of None ==&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="n">entries</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">),</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">)</span>

        <span class="n">newE</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s">&quot;_STD&quot;</span><span class="p">],</span> <span class="n">newE</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s">&quot;_MEAN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardDev</span><span class="p">,</span> <span class="n">meanOfAll</span>


    <span class="n">countE</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">entries</span><span class="p">[</span><span class="s">&quot;finalUrl&quot;</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">newE</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="s">&quot;difAuthorsPerEntry&quot;</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">entries</span><span class="p">[</span><span class="s">&quot;authors&quot;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">countE</span><span class="p">}</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">newE</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="clean_websiteout"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.clean_websiteout">[docs]</a><span class="k">def</span> <span class="nf">clean_websiteout</span><span class="p">(</span> <span class="n">websData</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cleaner for websiteoutlook.com&quot;&quot;&quot;</span>

    <span class="n">wanted_numeric</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pageviewsPerDay&#39;</span><span class="p">,</span> <span class="s">&#39;backlingsYahoo&#39;</span><span class="p">,</span> <span class="s">&#39;pageRank&#39;</span><span class="p">,</span> <span class="s">&#39;dailyUSD&#39;</span><span class="p">,</span> <span class="s">&#39;estimatedWorth&#39;</span><span class="p">,</span> <span class="s">&#39;websiteoutRank&#39;</span><span class="p">,</span> <span class="s">&#39;traficRank&#39;</span><span class="p">]</span>
    <span class="c"># wanted_text = [&#39;link&#39;]</span>

    <span class="n">newData</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># newData.update( {&#39;link&#39; : websData[&#39;link&#39;]} )</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">numbs_from_list</span><span class="p">(</span> <span class="n">websData</span><span class="p">,</span> <span class="n">wanted_numeric</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">newData</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="clean_alexa"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.clean_alexa">[docs]</a><span class="k">def</span> <span class="nf">clean_alexa</span><span class="p">(</span> <span class="n">alexData</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cleaner for alexa.com&quot;&quot;&quot;</span>

    <span class="n">wanted_numeric</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;searchVisits&#39;</span><span class="p">,</span>
                     <span class="s">&#39;bounceRate&#39;</span><span class="p">,</span>
                     <span class="s">&#39;dailyPagevPerVis&#39;</span><span class="p">,</span>
                     <span class="s">&#39;totalSitesLinking&#39;</span><span class="p">,</span>
                     <span class="s">&#39;globalRank&#39;</span><span class="p">]</span>


    <span class="n">newData</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># newData.update( {&#39;link&#39; : alexData[&#39;link&#39;]} )</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;dailyTimeOnSite&#39;</span> <span class="p">:</span> <span class="n">time_to_dec</span><span class="p">(</span> <span class="n">alexData</span><span class="p">[</span><span class="s">&#39;dailyTimeOnSite&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">numbs_from_list</span><span class="p">(</span> <span class="n">alexData</span><span class="p">,</span> <span class="n">wanted_numeric</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="s">&#39;dailyTimeOnSite&#39;</span> <span class="p">:</span> <span class="bp">None</span> <span class="p">}</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">newData</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="clean_urlm"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.clean_urlm">[docs]</a><span class="k">def</span> <span class="nf">clean_urlm</span><span class="p">(</span> <span class="n">urlmData</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cleaner for urlm.co&quot;&quot;&quot;</span>

    <span class="n">wanted_numeric</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;valuePerVis&#39;</span><span class="p">,</span> <span class="s">&#39;numberOfPages&#39;</span><span class="p">,</span> <span class="s">&#39;globalRank&#39;</span><span class="p">,</span> <span class="s">&#39;externalLinks&#39;</span><span class="p">,</span> <span class="s">&#39;monthlyVisits&#39;</span><span class="p">,</span> <span class="s">&#39;monthlyPagesViewed&#39;</span><span class="p">]</span>

    <span class="n">newData</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># newData.update( {&#39;link&#39; : urlmData[&#39;link&#39;]} )</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">numbs_from_list</span><span class="p">(</span> <span class="n">urlmData</span><span class="p">,</span> <span class="n">wanted_numeric</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">newData</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="clean_ranks"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.clean_ranks">[docs]</a><span class="k">def</span> <span class="nf">clean_ranks</span><span class="p">(</span> <span class="n">ranksData</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cleaner for ranks&quot;&quot;&quot;</span>

    <span class="n">wanted_numeric</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;rGoogle&#39;</span><span class="p">,</span>
         <span class="s">&#39;rAlexa&#39;</span><span class="p">,</span>
         <span class="s">&#39;rCompete&#39;</span><span class="p">,</span>
         <span class="s">&#39;rMozrank&#39;</span><span class="p">,</span>
         <span class="s">&#39;rSeznam&#39;</span><span class="p">,</span>
         <span class="s">&#39;rJyxo&#39;</span><span class="p">,</span>
         <span class="s">&#39;rMajestic&#39;</span><span class="p">,</span>
         <span class="s">&#39;rSiteExplorer&#39;</span><span class="p">,</span>
         <span class="s">&#39;rFacebook&#39;</span><span class="p">,</span>
         <span class="s">&#39;rTwitter&#39;</span><span class="p">,</span>
         <span class="s">&#39;rPlusoneG&#39;</span>
         <span class="p">]</span>

    <span class="n">newData</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">numbs_from_list</span><span class="p">(</span> <span class="n">ranksData</span><span class="p">,</span> <span class="n">wanted_numeric</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">newData</span> <span class="p">)</span>

</div>
<div class="viewcode-block" id="clean_feedInfo"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.clean_feedInfo">[docs]</a><span class="k">def</span> <span class="nf">clean_feedInfo</span><span class="p">(</span> <span class="n">feedData</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cleaner for feed info&quot;&quot;&quot;</span>

    <span class="n">newData</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">wantedAsTheyAre</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;bozo&quot;</span><span class="p">,</span> <span class="s">&quot;pub_freq&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">wantedAsTheyAre</span><span class="p">:</span>
        <span class="n">newData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="n">wantedIsPresent</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="s">&quot;tags&quot;</span><span class="p">,</span> <span class="s">&quot;subtitle&quot;</span><span class="p">,</span> <span class="s">&#39;published_parsed&#39;</span><span class="p">,</span> <span class="s">&quot;info&quot;</span><span class="p">]</span>
    <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">check_if_presents_list</span><span class="p">(</span> <span class="n">feedData</span><span class="p">,</span> <span class="n">wantedIsPresent</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c">### MAPING ###</span>
    <span class="n">fMap</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">mapDict</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">mapDict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="c"># 0 (zero) is for others</span>
    <span class="n">mappingVersion</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;rss20&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;atom10&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;atom03&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;rss091u&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;rss10&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="n">mappingStatus</span> <span class="o">=</span> <span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">301</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">302</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="p">[</span><span class="n">mappingStatus</span><span class="p">,</span> <span class="n">mappingVersion</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">,</span> <span class="s">&quot;version&quot;</span><span class="p">]</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">newData</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fMap</span><span class="p">(</span> <span class="n">d</span><span class="p">,</span> <span class="n">feedData</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">newData</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">feedData</span><span class="p">[</span><span class="s">&quot;n_of_entries&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">wrangle_entries</span><span class="p">(</span> <span class="n">feedData</span><span class="p">[</span><span class="s">&quot;entries&quot;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">entries</span> <span class="p">)</span>
        <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="s">&quot;entries&quot;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">}</span> <span class="p">)</span>
    <span class="k">elif</span> <span class="n">feedData</span><span class="p">[</span><span class="s">&quot;n_of_entries&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="s">&quot;entries&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">}</span> <span class="p">)</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">newData</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="clean_that_all"><a class="viewcode-back" href="../../nourisher.html#nourisher.cleaning.clean_that_all">[docs]</a><span class="k">def</span> <span class="nf">clean_that_all</span><span class="p">(</span> <span class="n">rawData</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for all cleaners&quot;&quot;&quot;</span>

    <span class="n">doms</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;urlm&#39;</span><span class="p">,</span> <span class="s">&#39;websiteout&#39;</span><span class="p">,</span> <span class="s">&#39;alexa&#39;</span><span class="p">,</span> <span class="s">&#39;feedInfo&#39;</span><span class="p">,</span> <span class="s">&#39;ranks&#39;</span><span class="p">]</span>
    <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_urlm</span><span class="p">,</span> <span class="n">clean_websiteout</span><span class="p">,</span> <span class="n">clean_alexa</span><span class="p">,</span> <span class="n">clean_feedInfo</span><span class="p">,</span> <span class="n">clean_ranks</span><span class="p">]</span>

    <span class="n">prepro</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">dom</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span> <span class="n">funcs</span><span class="p">,</span> <span class="n">doms</span> <span class="p">):</span>
        <span class="n">dataDomain</span> <span class="o">=</span> <span class="n">rawData</span><span class="p">[</span><span class="n">dom</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dataDomain</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># False if there are no data available for this domain</span>
            <span class="c"># and True if data were provided</span>
            <span class="n">prepro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="n">dom</span> <span class="p">:</span> <span class="bp">False</span><span class="p">}</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prepro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">func</span><span class="p">(</span> <span class="n">dataDomain</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">prepro</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">{</span><span class="n">dom</span> <span class="p">:</span> <span class="bp">True</span><span class="p">}</span> <span class="p">)</span>

    <span class="n">cleaned</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">diction</span> <span class="ow">in</span> <span class="n">prepro</span><span class="p">:</span>
        <span class="n">cleaned</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="nb">dict</span><span class="p">(</span> <span class="n">diction</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">cleaned</span> <span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">nourisher  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>